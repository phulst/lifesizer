(function(){var j=window.DomReady={};var h=navigator.userAgent.toLowerCase();var c={version:(h.match(/.+(?:rv|it|ra|ie)[\/: ]([\d.]+)/)||[])[1],safari:/webkit/.test(h),opera:/opera/.test(h),msie:(/msie/.test(h))&&(!/opera/.test(h)),mozilla:(/mozilla/.test(h))&&(!/(compatible|webkit)/.test(h))};var d=false;var e=false;var g=[];function a(){if(!e){e=true;if(g){for(var k=0;k<g.length;k++){g[k].call(window,[])}g=[]}}}function f(k){var l=window.onload;if(typeof window.onload!="function"){window.onload=k}else{window.onload=function(){if(l){l()}k()}}}function b(){if(d){return}d=true;if(document.addEventListener&&!c.opera){document.addEventListener("DOMContentLoaded",a,false)}if(c.msie&&window==top){(function(){if(e){return}try{document.documentElement.doScroll("left")}catch(l){setTimeout(arguments.callee,0);return}a()})()}if(c.opera){document.addEventListener("DOMContentLoaded",function(){if(e){return}for(var l=0;l<document.styleSheets.length;l++){if(document.styleSheets[l].disabled){setTimeout(arguments.callee,0);return}}a()},false)}if(c.safari){var k;(function(){if(e){return}if(document.readyState!="loaded"&&document.readyState!="complete"){setTimeout(arguments.callee,0);return}if(k===undefined){var l=document.getElementsByTagName("link");for(var m=0;m<l.length;m++){if(l[m].getAttribute("rel")=="stylesheet"){k++}}var n=document.getElementsByTagName("style");k+=n.length}if(document.styleSheets.length!=k){setTimeout(arguments.callee,0);return}a()})()}f(a)}j.ready=function(l,k){b();if(e){l.call(window,[])}else{g.push(function(){return l.call(window,[])})}};b()})();if(!window.Ls){window.Ls={options:{appKey:null,user:null,host:"beta.lifesizer.com",lsCacheHost:"lscache.lifesizer.com",assetsHost:"assets.lifesizer.com",popupWidth:600,popupHeight:400,overlayButtonType:0,overlayButtonPos:"left:5px; top:5px",overlayCustomImg:null,lightbox:false,serverCheck:false,notifyImages:null,notifyView:null,changeVisibility:true},dataAttr:function(b,a){return b.getAttribute("data-"+a)},getLifeSizeElements:function(){var b=[];var a=document.getElementsByTagName("*");for(i=0;i<a.length;i++){if(a[i].getAttribute("data-ls-ref")!=null&&a[i].getAttribute("data-ls-ref").length>0){b.push(a[i])}}return b},getElementWithClassName:function(e,f,c){if(!f){f="*"}var b=e.getElementsByTagName(f);var d=new Array();for(var a=0;a<b.length;a++){if(b[a].className==c){return b[a]}}return false},addListener:function(b,a,c){if(b.addEventListener){b.addEventListener(a,c,false)}else{if(b.attachEvent){b.attachEvent("on"+a,c)}else{b["on"+a]=c}}},ensureWrappedInDiv:function(b){function c(e){return(e.tagName.toLowerCase()=="div"&&e.style.position=="relative")}if(c(b)){return b}var a=b.parentNode;if(c(a)){return a}var d=document.createElement("div");d.style.position="relative";d.style.height=b.height+"px";d.style.width=b.width+"px";d.style.margin=0;d.style.padding=0;d.appendChild(b.cloneNode(true));a.replaceChild(d,b);return d},createOverlayLogo:function(a){var b="ls-overlay-button";var k=this;if(k.getElementWithClassName(a,"img",b)){return false}var g=6;var d=10;function c(m,n){m.style.opacity=n/10;m.style.filter="alpha(opacity="+n*10+")"}function e(m){return m.replace(/^\s+|\s+$/g,"")}function h(m){var s={};var q=m.split(";");for(var n=0;n<q.length;n++){if(e(q[n]).length>0){var r=q[n].split(":");var o=e(r[0]);s[o]=e(r[1])}}return s}var f=document.createElement("IMG");f.className=b;if(k.options.overlayButtonType>0){f.src="http://"+k.options.host+"/img/embed/logo_overlay"+k.options.overlayButtonType+".png"}else{if(k.options.overlayCustomImg){f.src=k.options.overlayCustomImg}}f.style.position="absolute";f.style.border="0px";f.style.padding="0px";c(f,g);var j=h(k.options.overlayButtonPos);for(var l in j){f.style[l]=j[l]}f.style.cursor="pointer";a.onmouseover=function(){c(f,d)};a.onmouseout=function(){c(f,g)};a.appendChild(f);return true},cancelEventBubble:function(a){if("cancelable" in a){if(a.cancelable){a.preventDefault()}}else{a.returnValue=false}if("bubbles" in a){if(a.bubbles){a.stopPropagation()}}else{a.cancelBubble=true}return false},init:function(c){var d=this;for(var b in c){d.options[b]=c[b]}var a=Ls.getLifeSizeElements();if(d.options.serverCheck){LsLog.debug("checking for "+a.length+" LifeSize images");d.checkLifeSizeImages(a)}else{LsLog.debug("enabling "+a.length+" LifeSize images");d.enableLifeSizeImages(a)}},addRef:function(a){imageRefCache.addRef(a)},arrayContains:function(a,c){var b=a.length;while(b--){if(a[b]===c){return true}}return false},collectRefs:function(c){var a=[];for(var b=0;b<c.length;b++){var d=this.dataAttr(c[b],"ls-ref");if(d&&d.length>0){if(!this.arrayContains(a,d)){a.push(d)}}}return a},checkLifeSizeImages:function(a){var b=this;imageRefCache.checkRefs(b.collectRefs(a),b.options,function(e){if(e&&e.length>0){var g=[];for(var d=0;d<a.length;d++){var f=b.dataAttr(a[d],"ls-ref");for(var c=0;c<e.length;c++){if(f==e[c]){g.push(a[d])}}}if(g.length>0){LsLog.info("enabling "+g.length+" images for "+e.length+" refs");b.enableLifeSizeImages(g)}}})},enableLifeSizeImages:function(d){var f=this;for(var c=0;c<d.length;c++){var e=d[c];var a=e;if(f.options.changeVisibility&&a.style.display=="none"){a.style.display=""}if(f.options.overlayButtonType>0||f.options.overlayCustomImg){a=f.ensureWrappedInDiv(e);f.createOverlayLogo(a)}a.style.cursor="pointer";f.addListener(a,"click",function(q){var h=window.event||q;var k=(h.currentTarget)?h.currentTarget:h.srcElement;if(!f.dataAttr(k,"ls-ref")){var n=k.childNodes.length;for(var m=0;m<n;m++){var g=k.childNodes[m];var p=f.dataAttr(g,"ls-ref");if(p){k=g;break}}}k.style.cursor="progress";var l=f.dataAttr(k,"ls-user");var j=f.dataAttr(k,"ls-ref");var o=f.dataAttr(k,"ls-prod");var s=f.dataAttr(k,"ls-imgurl");var r=f.dataAttr(k,"lifesizer");f.openViewer(j,o,l,s,r);k.style.cursor="pointer";return f.cancelEventBubble(h)})}if(f.options.notifyImages){var b=f.collectRefs(d);f.options.notifyImages(b)}},openViewer:function(e,g,a,h,c){var d=this;if(!a){a=d.options.user}var f={a:d.options.appKey,user:a,ref:e,h:screen.height,w:screen.width};if(g){f.p=g}if(h){f.img=h}if(f.user!=null&&f.ref!=null){if(!d.options.lightbox){var b="http://"+d.options.host+"/view";d.popup(b,f,d.options.popupWidth,d.options.popupHeight,c)}else{var b="http://"+d.options.host+"/view";d.lightboxView(b,f,d.options.popupWidth,d.options.popupHeight,c)}}if(d.options.notifyView){d.options.notifyView(f.ref)}},calculateBestWindowDim:function(d,f,b){if(!b){b=[60,150]}var a=[screen.availWidth,screen.availHeight];var e=new Array();for(var c=0;c<2;c++){e[c]=d[c]+b[c];if(d[c]+b[c]<f[c]){e[c]=f[c]}if(e[c]>a[c]){e[c]=a[c]}}return[e[0],e[1]]},constructUrl:function(b,d){var a=b+"?";for(var c in d){a+=c+"="+d[c]+"&"}a=a.substring(0,a.length-1);return a},popup:function(url,queryParams,width,height,lsData){var self=this;url=self.constructUrl(url,queryParams);var dim=[width,height];if(lsData){var data=eval("("+lsData+")");dim=self.calculateBestWindowDim([data.lsw,data.lsh],dim)}var params="width="+dim[0]+", height="+dim[1];params+=", directories=no";params+=", location=no";params+=", menubar=no";params+=", resizable=yes";params+=", scrollbars=no";params+=", status=no";params+=", toolbar=no";var newwin=window.open(url,queryParams.ref,params);if(window.focus){newwin.focus()}},lightboxView:function(url,params,width,height,lsData){var self=this;url=self.constructUrl(url,params);var dim=[width,height];if(lsData){var data=eval("("+lsData+")");dim=self.calculateBestWindowDim([data.lsw,data.lsh],dim)}$.colorbox({iframe:true,href:url,width:dim[0],height:dim[1],opacity:0.5})}}}var imageRefCache={options:{},callback:null,imageRefs:[],cacheTime:60*60,checkRefs:function(d,c,g){var f=this;f.options=c;f.callback=g;f.imageRefs=d;var b=false;if(this.localStorageSupported()){var e=localStorage[f._storageKey()];if(e==null){LsLog.debug("no refs available in localStorage for user "+c.appKey+", fetching now");b=true}else{if(!f._currentCache()){LsLog.debug("expired refs found in localStorage for user "+c.appKey+", fetching again");b=true}else{if(location.search.indexOf("lsdebug=true")>=0){LsLog.debug("lsdebug=true used, refreshing cache");b=true}}}if(b){this._loadRemoteRefs()}else{LsLog.debug("using cached imageref data");var a=e.split(",");this._testrefs(a)}}else{LsLog.debug("no localStorage support, checking "+d.length+" image refs with server");this._loadRemoteRefs()}},addRef:function(e){var d=this;var c=localStorage[d._storageKey()];var a=(c)?c.split(","):[];var f=false;for(var b=0;b<a.length;b++){if(a[b]===e){f=true;break}}if(!f){a.push(e);d._storeRefs(a)}},_storageKey:function(){return"lifesizer.user."+this.options.appKey+".refs"},_storageTimestampKey:function(){return this._storageKey()+".updated"},_loadRemoteRefs:function(){var a={url:"http://"+this.options.lsCacheHost+"/lsc/"+this.options.appKey+".js"};this.getJSONP(a)},notify:function(b){var a=this;LsLog.debug("jsonp response: ",b);if(b&&b.refs){if(this.localStorageSupported()){a._storeRefs(b.refs)}a._testrefs(b.refs,a.imageRefs)}},_storeRefs:function(a){var b=this;localStorage[b._storageKey()]=a.join(",");localStorage[b._storageTimestampKey()]=Math.round((new Date()).getTime()/1000);LsLog.debug("storing in localStorage: "+localStorage[b._storageKey()]+"\ntimestamp: "+localStorage[b._storageTimestampKey()])},_testrefs:function(a){var d=this;var e=[];for(var c=0;c<d.imageRefs.length;c++){for(var b=0;b<a.length;b++){if(a[b]==d.imageRefs[c]){e.push(d.imageRefs[c]);break}}}d.callback.call(d,e)},_currentCache:function(){var c=this;var a=localStorage[c._storageTimestampKey()];if(!a){return false}a=parseInt(a);if(!a){return false}var b=c.cacheTime-(Math.round((new Date()).getTime()/1000)-a);if(b>0){LsLog.debug("cache valid for another: "+b+" seconds")}else{LsLog.debug("cache expired by "+(0-b)+" seconds!")}return(b>0)},localStorageSupported:function(){return("localStorage" in window)&&window.localStorage!==null},getJSONP:function(f){var c=f.cacheMinutes||10;function b(l){var j="?";if(l){for(var h in l){j=j+h+"="+encodeURI(l[h])+"&"}}j.slice(0,-1);return j}var g={};if(f.data){for(var d in f.data){g[d]=f.data[d]}}if(f.callback){g.callback=f.callback}g.ts=Math.floor((new Date()).getTime()/(60*1000*c));var e=document.createElement("SCRIPT");var a=b(g);e.src=(a.length>0)?(f.url+a):f.url;document.getElementsByTagName("HEAD")[0].appendChild(e)}};LsLog={debug:function(b,a){this._msg("DEBUG",b,a)},info:function(b,a){this._msg("INFO ",b,a)},warn:function(b,a){this._msg("WARN ",b,a)},error:function(b,a){this._msg("ERROR",b,a)},_msg:function(c,b,a){if(window.console&&(location.search.indexOf("lsdebug=true")>=0)||location.host.indexOf("localhost")==0){console.log(c+" "+b);if(a&&window.console.dir){console.dir(a)}}}};DomReady.ready(function(){lsAsyncInit()});